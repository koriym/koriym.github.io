
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>GDD 2010 Pacman問題 - BEAR Blog</title>
  <meta name="author" content="Akihito Koriyama">

  
  <meta name="description" content="Tweet GDD 2010 Dev Quiz GDD2010のDev Quizの最終問題Pacman。DevQuizは見事不合格に終わったのですが、挑戦の記録というのと、提出後ですがLv.3が解けるようになったので記念に記します。 PHPで 普段使っているPHPでコーディングしました。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://koriym.github.io/2010/09/gdd-2010-pacman%e5%95%8f%e9%a1%8c/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="BEAR Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-6074569-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">BEAR Blog</a></h1>
  
    <h2>Because everything is a resource.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="koriym.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">GDD 2010 Pacman問題</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2010-09-17T00:00:00+09:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2010</span></span> <span class='time'>12:00 am</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://koriym.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><div style="float: right; margin-left: 10px;">
  <a href="https://twitter.com/share" class="twitter-share-button" data-count="vertical" data-url="http://www.bear-project.net/blog/2010/09/gdd-2010-pacman%e5%95%8f%e9%a1%8c/">Tweet</a>
</div>


<p><a href="http://www.bear-project.net/blog/wp-content/uploads/2010/09/gddpacmanlv3.png"><img src="http://www.bear-project.net/blog/wp-content/uploads/2010/09/gddpacmanlv3-300x185.png" alt="GDD 2010 Pacman Lv.3" title="GDD 2010 Pacman Lv.3" width="300" height="185" class="size-medium wp-image-133" /></a></p>

<h3>GDD 2010 Dev Quiz</h3>

<p>GDD2010のDev Quizの最終問題Pacman。DevQuizは見事不合格に終わったのですが、挑戦の記録というのと、提出後ですがLv.3が解けるようになったので記念に記します。</p>

<h3>PHPで</h3>

<p>普段使っているPHPでコーディングしました。WebではなくCLIです。1ファイルでコンソールでアニメが表示されるようにしました。現在のコードでのハイスコアはLv1, Lv2, Lv3それぞれ、41, 210, 489です。これは人の手をともわなないAI探索のみでのスコアです。</p>

<p><a href="http://www.bear-project.net/blog/wp-content/uploads/2010/09/pacman_lv3.mov">Pacman Lv.3 demo</a><sup><a href="#footnote_0_112" id="identifier_0_112" class="footnote-link footnote-identifier-link" title="この動画はAIによる移動です。再現プレイではありません。">1</a></sup></p>

<h3>Pacman AI</h3>

<p>最初にPacmanに適当な移動ロジックを組み込んでモンスターのいない迷路でドットが全部とれるかというところから始めました。</p>

<p>「誘惑に弱いけど好奇心が強く、失敗してもすぐに反省する」</p>

<p>こういうのどうだろう。Pacmanに性格をつけしてAIっぽい動きすれば面白いんじゃないかと。つまり&#8230;</p>

<ul>
<li>誘惑に弱い=隣接するドットを食べること優先</li>
<li>好奇心=足跡を記録してなるべく行っていないところに行く</li>
<li>すぐに反省＝反復強化学習</li>
</ul>


<p>こんな感じです。実装にうつります。</p>

<p>まず移動可能な場所（上下左右、０〜４カ所）を調べます。０〜2カ所なら自動的に決めます。</p>

<p>０カ所＝動けないので停止。<br/>
１カ所＝その方向に移動。<br/>
２カ所＝来た方向と逆の方向に（途中で反転しない）</p>

<p>※基本的にモンスターと同じです。</p>

<p>３、４カ所ある場合</p>

<p>移動可能な場所のうち、次の優先順位で方向を決めました。</p>

<ul>
<li>隣接するところにエサがあればその方向</li>
<li>隣接するところで一回しか行ってなければその方向</li>
<li>直線でエサが見えればその方向</li>
<li>上記のどれにもあたらなければランダム</li>
</ul>


<p>とりあえずこんなもので、この優先順位を変えたりできる仕組みもあればと。</p>

<h3>モンスターのいない迷路を走らせてみる</h3>

<p>迷路を自走させてみるとそれなりに効率的に走りドットを全て食べてくれます。ちょっと安心。<br/>
パックマンというより<a href="http://twitpic.com/2gmm04">自走式掃除機ルンバのような動き</a>です。みててなかなか面白い。</p>

<p>あとはモンスター&#8230;どうだろ？</p>

<p>モンスターは基本、壁と考えてみる。単にその場所にいけないという点で壁と同じ。つまりパックマン視点だと迷路が１フレーム単位で変化するようなもの。</p>

<p>元々迷路全体をしっかり把握してるわけでなし、上記のその場その場のロジックでドットが全部食べれるのだからまあ何万回も走らしたら全部適当に食べてくれるだろう&#8230;と。<sup><a href="#footnote_1_112" id="identifier_1_112" class="footnote-link footnote-identifier-link" title="結局その見通しは大甘でした">2</a></sup></p>

<h3>モンスターを組み込んでみる</h3>

<p>取りかかるとパックマン自走のコーディングのヒントと思えるようなとこが多々あり&#8230;先にモンスターからやれば良かったとすぐに気づきます。orz</p>

<p>パックマン自走コードにも手をなおしつつ、それでも一つ一つモンスターを組み込みます。</p>

<p>例えば敵V<sup><a href="#footnote_2_112" id="identifier_2_112" class="footnote-link footnote-identifier-link" title="AKABE?">3</a></sup> はこんな感じ。</p>

<blockquote><p>敵 V</p>

<ul>
<li><p>敵から見た自機の相対位置を (dx, dy) と表すものとします。次のルールを上から順に適用し、最初に選ばれた方向に移動します。</p></li>
<li><p>dy ≠ 0 でかつ dy の符号方向にあるマスが進入可能であれば、その方向に移動します。</p></li>
<li>dx ≠ 0 でかつ dx の符号方向にあるマスが進入可能であれば、その方向に移動します。</li>
<li>現在位置の 下、左、上、右 の順で最初に進入可能なマスの方向に移動する。</li>
</ul>
</blockquote>

<p>こういうABSでの割り算で方向を出すとか、中学生の時にBASICで書いて以来かも&#8230;とか懐かしみながら組み込んで行きます。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$ddy</span> <span class="o">=</span> <span class="nv">$dy</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="nv">$dy</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>敵L、敵R</h3>

<p>面倒そうなモンスターのロジックが出てきました。現在の方向からみての右、左です。</p>

<blockquote><p>敵 L</p>

<p>現在位置への進入方向から見て相対的に 左、前、右 の順で最初に進入可能なマスの方向に移動します。</p></blockquote>

<p>「右向いてるキャラの左は上」を求めるような実装です。普段しているWebのプログラミングで現在の方向からの相対的な「右」とか「左」は中々でてきません。</p>

<p>どうしようか、「もし今右を向いてたら、”右”は下方向」「下を向いてたら右は&#8230;」こういうのを４つ書くかなあ&#8230;いや&#8230;</p>

<p>&#8230;それもちょっと&#8230;そもそも「右」とは何かっていうと..うーん、国語辞書でも苦しい感じの説明だよなあ&#8230;.コーヒー飲みつつ色々考えながら窓の外を一分眺めます。</p>

<p>&#8230;配列で相対方向？</p>

<p>結局、「時計回り」の配列を用意して利用する方法を考えました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 時計回り配列</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_clockwiseDirection</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>array(0, 1)、array(-1, 0)&#8230;と下、左、上、右という時計回りの方向が並んでる配列（↓←↑→）です。</p>

<p>↓、←、↑、→と右回りの配列をつくって、１つ進んだら右回り、1つ後退したら左回り。</p>

<p>時計方向で並んでる配列の中で自分の「となりの右」が現在の方向から見た「右」です。配列の添字を１つ進めると右、減らすと左になります。一番右や左ではぐるっとまわって反対側の配列をとります。</p>

<p>うまく行きそうです。</p>

<p>モンスターはこれに優先順位があります。このようなコードになりました。<sup><a href="#footnote_3_112" id="identifier_3_112" class="footnote-link footnote-identifier-link" title="モンスタークラスにそれぞれの性格のモンスターがメソッドとして実装されていて迷路とPacmanの座標を受け取ったメソッドが進行方向を配列で返します。">4</a></sup></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスターL</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * 現在位置への進入方向から見て相対的に 左、前、右 の順</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param array $maze    迷路</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンX座標</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンY座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_moveL</span><span class="p">(</span><span class="k">array</span> <span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$directionStrategy</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getRelativeDirection</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_setPositionStatus</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$directionStrategy</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>     <span class="o">*/</span>
</span></code></pre></td></tr></table></div></figure>


<p>14行目:左（-1)、前(0)、右（1)を優先順位にした絶対方向座標が$directionStrategyとしてつくられます。<br/>
15行目: 迷路配列をみて、優先順位($directionStrategy)どおりの順番で壁ではないかチェックして移動可能な座標の配列をつくります。<br/>
16行目: 移動可能で優先順位の最も高い座標が配列の最初(0)にはいりっているのでそれを取り出します。</p>

<p>「特定の優先方向配列を用意して、その移動可能状態を調べ、個別ロジックによって移動方向を決定」&#8230;</p>

<p>これがキャラクターの移動の基本戦略となり、Pacmanにも利用しました。</p>

<p>モンスターの動きデバック用の迷路をつくり、動きを一つ一つ確認。コンソールでのPHPプログラムでしたがusleep()関数と画面クリアを使えば、コンソールでもアニメーションが見られるのがわかりました。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'> <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[;H</span><span class="se">\033</span><span class="s2">[2J&quot;</span><span class="p">;</span> <span class="c1">// これで画面クリア</span>
</span></code></pre></td></tr></table></div></figure>


<h3>いよいよモンスターのいる迷路をパックマンが自走</h3>

<p>予想と違ってなかなか厳しい。最初はクリアできませんでした。&hellip;.レベル１でさえも！！<br/>
当初、レベル３は現状の反復学習なし実装だと無理と確信します。</p>

<p>ところがレベル１は無理なのですが、レベル２をやると割とあっさりクリアできました。</p>

<p>？？？</p>

<p>debugモードで観察すると。効率よくするための「パックマンAI」が逆に正解ルートを必ず行けなくしてるのがわかりました。</p>

<p>レベル１の方針を変えます。</p>

<p>&ldquo;ランダム&rdquo;</p>

<p>何も考えずランダムに動かしてを繰り返すと数秒で最適解41点にたどりつけました。orz<br/>
レベル１、レベル２なんとか解けてそろそろタイムリミット。解けないLv.3の得点とソースコードを添えて提出しました。</p>

<h3>不合格、そしてLv.3クリア</h3>

<p>枠や開催場所によってはメアド入れたら通ったという方もいる中、GDD2010の参加不合格通知が届きます。結果からいうとパックマンはやる必要がないくらいの配点でした。<sup><a href="#footnote_4_112" id="identifier_4_112" class="footnote-link footnote-identifier-link" title="95%以上得点が圧縮調整されてました。参加者の得点が高かったのでしょう">5</a></sup> 自走パックマンに一生懸命で他の問題にほとんど手をつけてないのも原因でした。</p>

<p>しかししばらくして、やりかけだったプログラムの興味70%、勉強20%、パックマンLove10%という気持ちがLv.3解へのコーディングへと向かわせます。</p>

<p>反復学習の実装です。</p>

<h3>深さ優先探索</h3>

<div class="wp-caption alignright" style="width: 210px">
  <img alt="" src="http://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Depthfirst.png/200px-Depthfirst.png" title="反復木" width="200" height="197" /><p class="wp-caption-text">
    深さ優先探索のイメージ

</div>


<p>プログラムしたときは手法は思いついきで適当にした方法なのですが、実装が完全に終わって今日読んだオライリーの <a href="http://www.amazon.co.jp/gp/product/4873114284?ie=UTF8&amp;tag=koriymassoc-22&amp;linkCode=as2&amp;camp=247&amp;creative=1211&amp;creativeASIN=4873114284">アルゴリズムクイックリファレンス</a><img src="http://www.assoc-amazon.jp/e/ir?t=koriymassoc-22&#038;l=as2&#038;o=9&#038;a=4873114284" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />で分かったのがこれは<strong>深さ優先探索</strong>というものなんだそうです。 <sup><a href="#footnote_5_112" id="identifier_5_112" class="footnote-link footnote-identifier-link" title="それぐらい知っとけという感じですが">6</a></sup></p>

<p>wikiで以下のように説明されてます。</p>

<blockquote><p><a href="http://ja.wikipedia.org/wiki/%E6%B7%B1%E3%81%95%E5%84%AA%E5%85%88%E6%8E%A2%E7%B4%A2"></a><a href="http://ja.wikipedia.org/wiki/%E6%B7%B1%E3%81%95%E5%84%AA%E5%85%88%E6%8E%A2%E7%B4%A2">深さ優先探索</a>（ふかさゆうせんたんさく、英: depth-first search, DFS、バックトラック法ともいう）は、木やグラフを探索するためのアルゴリズムである。アルゴリズムは根から(グラフの場合はどのノードを根にするか決定する)始まり、バックトラックするまで可能な限り探索を行う。</p></blockquote>

<p>オライリー本からも引用します。</p>

<blockquote><p>「出来る限り前方に進み、同じ状態を二度と本文せずに、目的状態への経路を見つけようとする。探索木によっては、盤面の数が大変多くなるので、深さ優先探索は最大探索深さが前もって定まっているような場合にのみ実用的になる。深さ優先探索は、これから訪問する盤面状態をスタックに積み、訪問した盤面状態を集合に保持して、管理する。深さ優先探索は、スタックから未訪問の盤面状態を取り出し、可能な手を用いて、次の盤面状態集合を計算して木を拡張する。目標状態に到達したら、探索は終了する。」</p></blockquote>

<p>Pacmanでこう実装していました。<sup><a href="#footnote_6_112" id="identifier_6_112" class="footnote-link footnote-identifier-link" title="正に深さ優先探索！">7</a></sup></p>

<ul>
<li>ブランチは移動可能な場所が３つ以上あったとき</li>
<li>ブランチがあるときにそのゲーム状態をスタックに積む。</li>
<li>失敗したらスタックからゲームを取り出し失敗する前まで戻ってゲーム再開</li>
<li>自分の行動は記録し、失敗を繰り返さない</li>
</ul>


<p>※ゲーム全体はゲームオブジェクトとして１つの変数になってるので、それをarray_pushで配列としてスタックに積みます。<sup><a href="#footnote_7_112" id="identifier_7_112" class="footnote-link footnote-identifier-link" title="ゲームオブジェクトはプロパティとしてモンスターやパックマンのオブジェクトなどゲーム要素全てもっています。">8</a></sup></p>

<h3>探索木</h3>

<p>実際の動きはこのようになります。</p>

<p><code>
h mark 行き先(h)をマークし
 pushed 失敗しても前回の状態に戻れるように前回ゲームをスタックにつみ
h moved 進みます
hh mark 行き先(hh)をマークし...　　以下同様
h pushed
hh moved
hhk mark
hh pushed
hhk moved
hhkk mark
hhk pushed
hhkk moved
hhkkl mark
hhkk pushed
hhkkl moved
hhkkl GAME OVER ゲームオーバーになったので
hhkk is poped 積まれたゲームを上からとりだし
hhkkl is marked 移動可能方向を確認。hhkklという方角はすでに探索してるのでいきません。
hhkk GAME OVER 移動できる方角がもうないのでここでもゲームオーバーです。
hhk is poped その前につまれたゲームを取り出し    ....以下同様
hhkk is marked
hhk GAME OVER
hh is poped
hhk is marked
hhl mark
</code></p>

<p>これを繰り返せば全ての木の枝が探索できるはずです。<sup><a href="#footnote_8_112" id="identifier_8_112" class="footnote-link footnote-identifier-link" title="メモリと時間が許せば ">9</a></sup></p>

<h3>Lv.1でも全経路は無理?</h3>

<p>ところがそんなに簡単ではありません。Lv1くらい無条件の全経路を調べられないかと思いましたが、やはり難しそうです。この動画が少し参考になるでしょうか。階乗の計算量は膨大です。</p>

<p><a href="http://www.bear-project.net/blog/wp-content/uploads/2010/09/stack.mov">GDD Pacman LV.1 Deep-First Search</a></p>

<p>Lv2, Lv3では３つ以上の交差点でのみブランチをつくることにしました。また時間によるゲームオーバーからはスタックからゲームを取り出すことなしに、最初からやり直すのを繰り返す事にしました。<sup><a href="#footnote_9_112" id="identifier_9_112" class="footnote-link footnote-identifier-link" title="その方がスコアが良く、ランダムで繰り返しても同じゲームが再現することがほとんどありませんででした">10</a></sup> <sup><a href="#footnote_10_112" id="identifier_10_112" class="footnote-link footnote-identifier-link" title="ゲームオーバー時に積まれたゲームスタックを再評価し、10,000回に一回しか出ないような良いスコアの途中のゲーム状態から再開してみる..など色々やってみましたがあまりスコアアップに繋がりませんでした。オライリー本にもありますが&quot;大器晩成型&quot;のスコアがとであがってくるタイプのを消してしまうからではないかと思いました。">11</a></sup></p>

<h3>幅優先探索</h3>

<p>試してはいませんが、他の検索の紹介を。幅優先探索も同じ様に同じ状態を２度と訪問しないようにして、ゲーム状態を初期状態から近い順に評価します。深さ優先と違うのは、探索開始点から近いところから順に探索をしていくところです。深さ優先探索がスタックを使用するのに対して、幅優先探索はキューをする違いを理解すれば実装のイメージがわくのではないでしょうか。<sup><a href="#footnote_11_112" id="identifier_11_112" class="footnote-link footnote-identifier-link" title="これも膨大なメモリを要します。他にもいろいろな探索がオライリー本に紹介されてますがどれが一番向いてたのでしょうか">12</a></sup></p>

<p><a href="http://www.bear-project.net/blog/wp-content/uploads/2010/09/300px-Breadth-first-tree.png"><img src="http://www.bear-project.net/blog/wp-content/uploads/2010/09/300px-Breadth-first-tree.png" alt="" title="Breadth-Frst-Tree" width="300" height="207" class="aligncenter size-full wp-image-191" /></a></p>

<h3>Lv.2, Lv.3の探索木</h3>

<p>交差点だけブランチをつくるLv.2とLv.3でタイムオーバーまでゲームをしたら大体100ゲーム超ぐらいのゲームがスタックされます。Lv.2、Lv.3もあまり変わらなくLv.3がやや多いくらいです。</p>

<p>以下はタイムオーバーまで５回プレイした例です。</p>

<p><code>
Lv.3
Score:284/296 Point:284 Game:700/700 Stacked Game:107
Score:277/296 Point:277 Game:700/700 Stacked Game:103
Score:277/296 Point:277 Game:700/700 Stacked Game:111
Score:269/296 Point:269 Game:700/700 Stacked Game:107
Score:267/296 Point:267 Game:700/700 Stacked Game:101
Lv.2
Score:131/147 Point:131 Game:300/300 Stacked Game:107
Score:129/147 Point:129 Game:300/300 Stacked Game:112
Score:120/147 Point:120 Game:300/300 Stacked Game:111
Score:127/147 Point:127 Game:300/300 Stacked Game:101
Score:135/147 Point:135 Game:300/300 Stacked Game:100
</code></p>

<p>なかなか良いスコアです。これが一瞬で出るので、これを一晩ぶん回せば&hellip;と期待してしまいますがここからのスコアはなかなか伸びません。<sup><a href="#footnote_12_112" id="identifier_12_112" class="footnote-link footnote-identifier-link" title="残りドットが少なくなったら取りにいくロジックを追加したらかなり性能があがるかもしれません">13</a></sup> ３ドット取り残しとゲームクリアではクイズの配点としての差はあまりないでしょうけど、プログラムの性能としては格段に違います。</p>

<p>それでもLv.3クリアが一瞬から数分程度でできるまでの性能になりました。僕のGDD2010はここで終わりです。</p>

<h3>最後に</h3>

<p>昔の事ですがファミコンやゲームボーイでアクションゲームをいくつか作ったことがあります。<sup><a href="#footnote_13_112" id="identifier_13_112" class="footnote-link footnote-identifier-link" title="アセンブラは16bitのスーパーファミコン(65816)、メガドライブ (680000+Z80)までやりました">14</a></sup> 中高生の時もBASICや機械語<sup><a href="#footnote_14_112" id="identifier_14_112" class="footnote-link footnote-identifier-link" title="懐かしい響き!">15</a></sup> でこういうキャラクタベースのゲームを趣味でつくったりしてました。<sup><a href="#footnote_15_112" id="identifier_15_112" class="footnote-link footnote-identifier-link" title="自機が&rdquo;＠&rdquo;でした！当時いろんなゲームの自機が@。PC-6001用ASCIIのAXシリーズとか...">16</a></sup></p>

<p>思えばそれ以来のゲームプログラミングです。これからもこういうプログラムはする事はなかなかないと思うので貴重な機会となりました。参加はなりませんでしたが<a href="http://www.google.co.jp/search?q=%23gdd2010jp&amp;hl=ja&amp;safe=off&amp;prmd=u&amp;tbs=mbl:1&amp;tbo=u&amp;ei=qguTTNWoFcqHceyWjbkG&amp;sa=X&amp;oi=realtime_result_group_more_results_link&amp;ct=title&amp;resnum=4&amp;ved=0CDMQ5QUwAw">#gdd2010jp</a>で他の参加者の話を聞いたりコードを見たりするのも楽しかったです。<a href="http://togetter.com/li/44476">GDD2010JP DevQuiz ソース晒し祭り</a>でもPHPや自動探査で解いてるコードが少ないのとどういう風にコーディングしたらいいかさっぱり分からないという方もTLで散見したりで、多少なりとも参考になればと思い記事をかきました。</p>

<p>最後に<a href="http://twitter.com/asannou">asannou</a>さんの作製の素晴らしい<a href="http://www.gmodules.com/ig/creator?synd=open&amp;url=http://ido.nu/ayaya/pacman3.xml">ガジェット</a><sup><a href="#footnote_16_112" id="identifier_16_112" class="footnote-link footnote-identifier-link" title="動作確認にも大変世話になりました">17</a></sup> を貼付けて終わりにします。Lv.3クリアのベストスコアです。<sup><a href="#footnote_17_112" id="identifier_17_112" class="footnote-link footnote-identifier-link" title="AI検索のみの移動です。人の手による修正はありません">18</a></sup>　長文読んで頂いてありがとうございました。</p>

<h3>ソースコード</h3>

<p>ダウンロードは<a href="http://codepad.org/Xuv8jJIZ">code pad</a>で</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
<span class='line-number'>362</span>
<span class='line-number'>363</span>
<span class='line-number'>364</span>
<span class='line-number'>365</span>
<span class='line-number'>366</span>
<span class='line-number'>367</span>
<span class='line-number'>368</span>
<span class='line-number'>369</span>
<span class='line-number'>370</span>
<span class='line-number'>371</span>
<span class='line-number'>372</span>
<span class='line-number'>373</span>
<span class='line-number'>374</span>
<span class='line-number'>375</span>
<span class='line-number'>376</span>
<span class='line-number'>377</span>
<span class='line-number'>378</span>
<span class='line-number'>379</span>
<span class='line-number'>380</span>
<span class='line-number'>381</span>
<span class='line-number'>382</span>
<span class='line-number'>383</span>
<span class='line-number'>384</span>
<span class='line-number'>385</span>
<span class='line-number'>386</span>
<span class='line-number'>387</span>
<span class='line-number'>388</span>
<span class='line-number'>389</span>
<span class='line-number'>390</span>
<span class='line-number'>391</span>
<span class='line-number'>392</span>
<span class='line-number'>393</span>
<span class='line-number'>394</span>
<span class='line-number'>395</span>
<span class='line-number'>396</span>
<span class='line-number'>397</span>
<span class='line-number'>398</span>
<span class='line-number'>399</span>
<span class='line-number'>400</span>
<span class='line-number'>401</span>
<span class='line-number'>402</span>
<span class='line-number'>403</span>
<span class='line-number'>404</span>
<span class='line-number'>405</span>
<span class='line-number'>406</span>
<span class='line-number'>407</span>
<span class='line-number'>408</span>
<span class='line-number'>409</span>
<span class='line-number'>410</span>
<span class='line-number'>411</span>
<span class='line-number'>412</span>
<span class='line-number'>413</span>
<span class='line-number'>414</span>
<span class='line-number'>415</span>
<span class='line-number'>416</span>
<span class='line-number'>417</span>
<span class='line-number'>418</span>
<span class='line-number'>419</span>
<span class='line-number'>420</span>
<span class='line-number'>421</span>
<span class='line-number'>422</span>
<span class='line-number'>423</span>
<span class='line-number'>424</span>
<span class='line-number'>425</span>
<span class='line-number'>426</span>
<span class='line-number'>427</span>
<span class='line-number'>428</span>
<span class='line-number'>429</span>
<span class='line-number'>430</span>
<span class='line-number'>431</span>
<span class='line-number'>432</span>
<span class='line-number'>433</span>
<span class='line-number'>434</span>
<span class='line-number'>435</span>
<span class='line-number'>436</span>
<span class='line-number'>437</span>
<span class='line-number'>438</span>
<span class='line-number'>439</span>
<span class='line-number'>440</span>
<span class='line-number'>441</span>
<span class='line-number'>442</span>
<span class='line-number'>443</span>
<span class='line-number'>444</span>
<span class='line-number'>445</span>
<span class='line-number'>446</span>
<span class='line-number'>447</span>
<span class='line-number'>448</span>
<span class='line-number'>449</span>
<span class='line-number'>450</span>
<span class='line-number'>451</span>
<span class='line-number'>452</span>
<span class='line-number'>453</span>
<span class='line-number'>454</span>
<span class='line-number'>455</span>
<span class='line-number'>456</span>
<span class='line-number'>457</span>
<span class='line-number'>458</span>
<span class='line-number'>459</span>
<span class='line-number'>460</span>
<span class='line-number'>461</span>
<span class='line-number'>462</span>
<span class='line-number'>463</span>
<span class='line-number'>464</span>
<span class='line-number'>465</span>
<span class='line-number'>466</span>
<span class='line-number'>467</span>
<span class='line-number'>468</span>
<span class='line-number'>469</span>
<span class='line-number'>470</span>
<span class='line-number'>471</span>
<span class='line-number'>472</span>
<span class='line-number'>473</span>
<span class='line-number'>474</span>
<span class='line-number'>475</span>
<span class='line-number'>476</span>
<span class='line-number'>477</span>
<span class='line-number'>478</span>
<span class='line-number'>479</span>
<span class='line-number'>480</span>
<span class='line-number'>481</span>
<span class='line-number'>482</span>
<span class='line-number'>483</span>
<span class='line-number'>484</span>
<span class='line-number'>485</span>
<span class='line-number'>486</span>
<span class='line-number'>487</span>
<span class='line-number'>488</span>
<span class='line-number'>489</span>
<span class='line-number'>490</span>
<span class='line-number'>491</span>
<span class='line-number'>492</span>
<span class='line-number'>493</span>
<span class='line-number'>494</span>
<span class='line-number'>495</span>
<span class='line-number'>496</span>
<span class='line-number'>497</span>
<span class='line-number'>498</span>
<span class='line-number'>499</span>
<span class='line-number'>500</span>
<span class='line-number'>501</span>
<span class='line-number'>502</span>
<span class='line-number'>503</span>
<span class='line-number'>504</span>
<span class='line-number'>505</span>
<span class='line-number'>506</span>
<span class='line-number'>507</span>
<span class='line-number'>508</span>
<span class='line-number'>509</span>
<span class='line-number'>510</span>
<span class='line-number'>511</span>
<span class='line-number'>512</span>
<span class='line-number'>513</span>
<span class='line-number'>514</span>
<span class='line-number'>515</span>
<span class='line-number'>516</span>
<span class='line-number'>517</span>
<span class='line-number'>518</span>
<span class='line-number'>519</span>
<span class='line-number'>520</span>
<span class='line-number'>521</span>
<span class='line-number'>522</span>
<span class='line-number'>523</span>
<span class='line-number'>524</span>
<span class='line-number'>525</span>
<span class='line-number'>526</span>
<span class='line-number'>527</span>
<span class='line-number'>528</span>
<span class='line-number'>529</span>
<span class='line-number'>530</span>
<span class='line-number'>531</span>
<span class='line-number'>532</span>
<span class='line-number'>533</span>
<span class='line-number'>534</span>
<span class='line-number'>535</span>
<span class='line-number'>536</span>
<span class='line-number'>537</span>
<span class='line-number'>538</span>
<span class='line-number'>539</span>
<span class='line-number'>540</span>
<span class='line-number'>541</span>
<span class='line-number'>542</span>
<span class='line-number'>543</span>
<span class='line-number'>544</span>
<span class='line-number'>545</span>
<span class='line-number'>546</span>
<span class='line-number'>547</span>
<span class='line-number'>548</span>
<span class='line-number'>549</span>
<span class='line-number'>550</span>
<span class='line-number'>551</span>
<span class='line-number'>552</span>
<span class='line-number'>553</span>
<span class='line-number'>554</span>
<span class='line-number'>555</span>
<span class='line-number'>556</span>
<span class='line-number'>557</span>
<span class='line-number'>558</span>
<span class='line-number'>559</span>
<span class='line-number'>560</span>
<span class='line-number'>561</span>
<span class='line-number'>562</span>
<span class='line-number'>563</span>
<span class='line-number'>564</span>
<span class='line-number'>565</span>
<span class='line-number'>566</span>
<span class='line-number'>567</span>
<span class='line-number'>568</span>
<span class='line-number'>569</span>
<span class='line-number'>570</span>
<span class='line-number'>571</span>
<span class='line-number'>572</span>
<span class='line-number'>573</span>
<span class='line-number'>574</span>
<span class='line-number'>575</span>
<span class='line-number'>576</span>
<span class='line-number'>577</span>
<span class='line-number'>578</span>
<span class='line-number'>579</span>
<span class='line-number'>580</span>
<span class='line-number'>581</span>
<span class='line-number'>582</span>
<span class='line-number'>583</span>
<span class='line-number'>584</span>
<span class='line-number'>585</span>
<span class='line-number'>586</span>
<span class='line-number'>587</span>
<span class='line-number'>588</span>
<span class='line-number'>589</span>
<span class='line-number'>590</span>
<span class='line-number'>591</span>
<span class='line-number'>592</span>
<span class='line-number'>593</span>
<span class='line-number'>594</span>
<span class='line-number'>595</span>
<span class='line-number'>596</span>
<span class='line-number'>597</span>
<span class='line-number'>598</span>
<span class='line-number'>599</span>
<span class='line-number'>600</span>
<span class='line-number'>601</span>
<span class='line-number'>602</span>
<span class='line-number'>603</span>
<span class='line-number'>604</span>
<span class='line-number'>605</span>
<span class='line-number'>606</span>
<span class='line-number'>607</span>
<span class='line-number'>608</span>
<span class='line-number'>609</span>
<span class='line-number'>610</span>
<span class='line-number'>611</span>
<span class='line-number'>612</span>
<span class='line-number'>613</span>
<span class='line-number'>614</span>
<span class='line-number'>615</span>
<span class='line-number'>616</span>
<span class='line-number'>617</span>
<span class='line-number'>618</span>
<span class='line-number'>619</span>
<span class='line-number'>620</span>
<span class='line-number'>621</span>
<span class='line-number'>622</span>
<span class='line-number'>623</span>
<span class='line-number'>624</span>
<span class='line-number'>625</span>
<span class='line-number'>626</span>
<span class='line-number'>627</span>
<span class='line-number'>628</span>
<span class='line-number'>629</span>
<span class='line-number'>630</span>
<span class='line-number'>631</span>
<span class='line-number'>632</span>
<span class='line-number'>633</span>
<span class='line-number'>634</span>
<span class='line-number'>635</span>
<span class='line-number'>636</span>
<span class='line-number'>637</span>
<span class='line-number'>638</span>
<span class='line-number'>639</span>
<span class='line-number'>640</span>
<span class='line-number'>641</span>
<span class='line-number'>642</span>
<span class='line-number'>643</span>
<span class='line-number'>644</span>
<span class='line-number'>645</span>
<span class='line-number'>646</span>
<span class='line-number'>647</span>
<span class='line-number'>648</span>
<span class='line-number'>649</span>
<span class='line-number'>650</span>
<span class='line-number'>651</span>
<span class='line-number'>652</span>
<span class='line-number'>653</span>
<span class='line-number'>654</span>
<span class='line-number'>655</span>
<span class='line-number'>656</span>
<span class='line-number'>657</span>
<span class='line-number'>658</span>
<span class='line-number'>659</span>
<span class='line-number'>660</span>
<span class='line-number'>661</span>
<span class='line-number'>662</span>
<span class='line-number'>663</span>
<span class='line-number'>664</span>
<span class='line-number'>665</span>
<span class='line-number'>666</span>
<span class='line-number'>667</span>
<span class='line-number'>668</span>
<span class='line-number'>669</span>
<span class='line-number'>670</span>
<span class='line-number'>671</span>
<span class='line-number'>672</span>
<span class='line-number'>673</span>
<span class='line-number'>674</span>
<span class='line-number'>675</span>
<span class='line-number'>676</span>
<span class='line-number'>677</span>
<span class='line-number'>678</span>
<span class='line-number'>679</span>
<span class='line-number'>680</span>
<span class='line-number'>681</span>
<span class='line-number'>682</span>
<span class='line-number'>683</span>
<span class='line-number'>684</span>
<span class='line-number'>685</span>
<span class='line-number'>686</span>
<span class='line-number'>687</span>
<span class='line-number'>688</span>
<span class='line-number'>689</span>
<span class='line-number'>690</span>
<span class='line-number'>691</span>
<span class='line-number'>692</span>
<span class='line-number'>693</span>
<span class='line-number'>694</span>
<span class='line-number'>695</span>
<span class='line-number'>696</span>
<span class='line-number'>697</span>
<span class='line-number'>698</span>
<span class='line-number'>699</span>
<span class='line-number'>700</span>
<span class='line-number'>701</span>
<span class='line-number'>702</span>
<span class='line-number'>703</span>
<span class='line-number'>704</span>
<span class='line-number'>705</span>
<span class='line-number'>706</span>
<span class='line-number'>707</span>
<span class='line-number'>708</span>
<span class='line-number'>709</span>
<span class='line-number'>710</span>
<span class='line-number'>711</span>
<span class='line-number'>712</span>
<span class='line-number'>713</span>
<span class='line-number'>714</span>
<span class='line-number'>715</span>
<span class='line-number'>716</span>
<span class='line-number'>717</span>
<span class='line-number'>718</span>
<span class='line-number'>719</span>
<span class='line-number'>720</span>
<span class='line-number'>721</span>
<span class='line-number'>722</span>
<span class='line-number'>723</span>
<span class='line-number'>724</span>
<span class='line-number'>725</span>
<span class='line-number'>726</span>
<span class='line-number'>727</span>
<span class='line-number'>728</span>
<span class='line-number'>729</span>
<span class='line-number'>730</span>
<span class='line-number'>731</span>
<span class='line-number'>732</span>
<span class='line-number'>733</span>
<span class='line-number'>734</span>
<span class='line-number'>735</span>
<span class='line-number'>736</span>
<span class='line-number'>737</span>
<span class='line-number'>738</span>
<span class='line-number'>739</span>
<span class='line-number'>740</span>
<span class='line-number'>741</span>
<span class='line-number'>742</span>
<span class='line-number'>743</span>
<span class='line-number'>744</span>
<span class='line-number'>745</span>
<span class='line-number'>746</span>
<span class='line-number'>747</span>
<span class='line-number'>748</span>
<span class='line-number'>749</span>
<span class='line-number'>750</span>
<span class='line-number'>751</span>
<span class='line-number'>752</span>
<span class='line-number'>753</span>
<span class='line-number'>754</span>
<span class='line-number'>755</span>
<span class='line-number'>756</span>
<span class='line-number'>757</span>
<span class='line-number'>758</span>
<span class='line-number'>759</span>
<span class='line-number'>760</span>
<span class='line-number'>761</span>
<span class='line-number'>762</span>
<span class='line-number'>763</span>
<span class='line-number'>764</span>
<span class='line-number'>765</span>
<span class='line-number'>766</span>
<span class='line-number'>767</span>
<span class='line-number'>768</span>
<span class='line-number'>769</span>
<span class='line-number'>770</span>
<span class='line-number'>771</span>
<span class='line-number'>772</span>
<span class='line-number'>773</span>
<span class='line-number'>774</span>
<span class='line-number'>775</span>
<span class='line-number'>776</span>
<span class='line-number'>777</span>
<span class='line-number'>778</span>
<span class='line-number'>779</span>
<span class='line-number'>780</span>
<span class='line-number'>781</span>
<span class='line-number'>782</span>
<span class='line-number'>783</span>
<span class='line-number'>784</span>
<span class='line-number'>785</span>
<span class='line-number'>786</span>
<span class='line-number'>787</span>
<span class='line-number'>788</span>
<span class='line-number'>789</span>
<span class='line-number'>790</span>
<span class='line-number'>791</span>
<span class='line-number'>792</span>
<span class='line-number'>793</span>
<span class='line-number'>794</span>
<span class='line-number'>795</span>
<span class='line-number'>796</span>
<span class='line-number'>797</span>
<span class='line-number'>798</span>
<span class='line-number'>799</span>
<span class='line-number'>800</span>
<span class='line-number'>801</span>
<span class='line-number'>802</span>
<span class='line-number'>803</span>
<span class='line-number'>804</span>
<span class='line-number'>805</span>
<span class='line-number'>806</span>
<span class='line-number'>807</span>
<span class='line-number'>808</span>
<span class='line-number'>809</span>
<span class='line-number'>810</span>
<span class='line-number'>811</span>
<span class='line-number'>812</span>
<span class='line-number'>813</span>
<span class='line-number'>814</span>
<span class='line-number'>815</span>
<span class='line-number'>816</span>
<span class='line-number'>817</span>
<span class='line-number'>818</span>
<span class='line-number'>819</span>
<span class='line-number'>820</span>
<span class='line-number'>821</span>
<span class='line-number'>822</span>
<span class='line-number'>823</span>
<span class='line-number'>824</span>
<span class='line-number'>825</span>
<span class='line-number'>826</span>
<span class='line-number'>827</span>
<span class='line-number'>828</span>
<span class='line-number'>829</span>
<span class='line-number'>830</span>
<span class='line-number'>831</span>
<span class='line-number'>832</span>
<span class='line-number'>833</span>
<span class='line-number'>834</span>
<span class='line-number'>835</span>
<span class='line-number'>836</span>
<span class='line-number'>837</span>
<span class='line-number'>838</span>
<span class='line-number'>839</span>
<span class='line-number'>840</span>
<span class='line-number'>841</span>
<span class='line-number'>842</span>
<span class='line-number'>843</span>
<span class='line-number'>844</span>
<span class='line-number'>845</span>
<span class='line-number'>846</span>
<span class='line-number'>847</span>
<span class='line-number'>848</span>
<span class='line-number'>849</span>
<span class='line-number'>850</span>
<span class='line-number'>851</span>
<span class='line-number'>852</span>
<span class='line-number'>853</span>
<span class='line-number'>854</span>
<span class='line-number'>855</span>
<span class='line-number'>856</span>
<span class='line-number'>857</span>
<span class='line-number'>858</span>
<span class='line-number'>859</span>
<span class='line-number'>860</span>
<span class='line-number'>861</span>
<span class='line-number'>862</span>
<span class='line-number'>863</span>
<span class='line-number'>864</span>
<span class='line-number'>865</span>
<span class='line-number'>866</span>
<span class='line-number'>867</span>
<span class='line-number'>868</span>
<span class='line-number'>869</span>
<span class='line-number'>870</span>
<span class='line-number'>871</span>
<span class='line-number'>872</span>
<span class='line-number'>873</span>
<span class='line-number'>874</span>
<span class='line-number'>875</span>
<span class='line-number'>876</span>
<span class='line-number'>877</span>
<span class='line-number'>878</span>
<span class='line-number'>879</span>
<span class='line-number'>880</span>
<span class='line-number'>881</span>
<span class='line-number'>882</span>
<span class='line-number'>883</span>
<span class='line-number'>884</span>
<span class='line-number'>885</span>
<span class='line-number'>886</span>
<span class='line-number'>887</span>
<span class='line-number'>888</span>
<span class='line-number'>889</span>
<span class='line-number'>890</span>
<span class='line-number'>891</span>
<span class='line-number'>892</span>
<span class='line-number'>893</span>
<span class='line-number'>894</span>
<span class='line-number'>895</span>
<span class='line-number'>896</span>
<span class='line-number'>897</span>
<span class='line-number'>898</span>
<span class='line-number'>899</span>
<span class='line-number'>900</span>
<span class='line-number'>901</span>
<span class='line-number'>902</span>
<span class='line-number'>903</span>
<span class='line-number'>904</span>
<span class='line-number'>905</span>
<span class='line-number'>906</span>
<span class='line-number'>907</span>
<span class='line-number'>908</span>
<span class='line-number'>909</span>
<span class='line-number'>910</span>
<span class='line-number'>911</span>
<span class='line-number'>912</span>
<span class='line-number'>913</span>
<span class='line-number'>914</span>
<span class='line-number'>915</span>
<span class='line-number'>916</span>
<span class='line-number'>917</span>
<span class='line-number'>918</span>
<span class='line-number'>919</span>
<span class='line-number'>920</span>
<span class='line-number'>921</span>
<span class='line-number'>922</span>
<span class='line-number'>923</span>
<span class='line-number'>924</span>
<span class='line-number'>925</span>
<span class='line-number'>926</span>
<span class='line-number'>927</span>
<span class='line-number'>928</span>
<span class='line-number'>929</span>
<span class='line-number'>930</span>
<span class='line-number'>931</span>
<span class='line-number'>932</span>
<span class='line-number'>933</span>
<span class='line-number'>934</span>
<span class='line-number'>935</span>
<span class='line-number'>936</span>
<span class='line-number'>937</span>
<span class='line-number'>938</span>
<span class='line-number'>939</span>
<span class='line-number'>940</span>
<span class='line-number'>941</span>
<span class='line-number'>942</span>
<span class='line-number'>943</span>
<span class='line-number'>944</span>
<span class='line-number'>945</span>
<span class='line-number'>946</span>
<span class='line-number'>947</span>
<span class='line-number'>948</span>
<span class='line-number'>949</span>
<span class='line-number'>950</span>
<span class='line-number'>951</span>
<span class='line-number'>952</span>
<span class='line-number'>953</span>
<span class='line-number'>954</span>
<span class='line-number'>955</span>
<span class='line-number'>956</span>
<span class='line-number'>957</span>
<span class='line-number'>958</span>
<span class='line-number'>959</span>
<span class='line-number'>960</span>
<span class='line-number'>961</span>
<span class='line-number'>962</span>
<span class='line-number'>963</span>
<span class='line-number'>964</span>
<span class='line-number'>965</span>
<span class='line-number'>966</span>
<span class='line-number'>967</span>
<span class='line-number'>968</span>
<span class='line-number'>969</span>
<span class='line-number'>970</span>
<span class='line-number'>971</span>
<span class='line-number'>972</span>
<span class='line-number'>973</span>
<span class='line-number'>974</span>
<span class='line-number'>975</span>
<span class='line-number'>976</span>
<span class='line-number'>977</span>
<span class='line-number'>978</span>
<span class='line-number'>979</span>
<span class='line-number'>980</span>
<span class='line-number'>981</span>
<span class='line-number'>982</span>
<span class='line-number'>983</span>
<span class='line-number'>984</span>
<span class='line-number'>985</span>
<span class='line-number'>986</span>
<span class='line-number'>987</span>
<span class='line-number'>988</span>
<span class='line-number'>989</span>
<span class='line-number'>990</span>
<span class='line-number'>991</span>
<span class='line-number'>992</span>
<span class='line-number'>993</span>
<span class='line-number'>994</span>
<span class='line-number'>995</span>
<span class='line-number'>996</span>
<span class='line-number'>997</span>
<span class='line-number'>998</span>
<span class='line-number'>999</span>
<span class='line-number'>1000</span>
<span class='line-number'>1001</span>
<span class='line-number'>1002</span>
<span class='line-number'>1003</span>
<span class='line-number'>1004</span>
<span class='line-number'>1005</span>
<span class='line-number'>1006</span>
<span class='line-number'>1007</span>
<span class='line-number'>1008</span>
<span class='line-number'>1009</span>
<span class='line-number'>1010</span>
<span class='line-number'>1011</span>
<span class='line-number'>1012</span>
<span class='line-number'>1013</span>
<span class='line-number'>1014</span>
<span class='line-number'>1015</span>
<span class='line-number'>1016</span>
<span class='line-number'>1017</span>
<span class='line-number'>1018</span>
<span class='line-number'>1019</span>
<span class='line-number'>1020</span>
<span class='line-number'>1021</span>
<span class='line-number'>1022</span>
<span class='line-number'>1023</span>
<span class='line-number'>1024</span>
<span class='line-number'>1025</span>
<span class='line-number'>1026</span>
<span class='line-number'>1027</span>
<span class='line-number'>1028</span>
<span class='line-number'>1029</span>
<span class='line-number'>1030</span>
<span class='line-number'>1031</span>
<span class='line-number'>1032</span>
<span class='line-number'>1033</span>
<span class='line-number'>1034</span>
<span class='line-number'>1035</span>
<span class='line-number'>1036</span>
<span class='line-number'>1037</span>
<span class='line-number'>1038</span>
<span class='line-number'>1039</span>
<span class='line-number'>1040</span>
<span class='line-number'>1041</span>
<span class='line-number'>1042</span>
<span class='line-number'>1043</span>
<span class='line-number'>1044</span>
<span class='line-number'>1045</span>
<span class='line-number'>1046</span>
<span class='line-number'>1047</span>
<span class='line-number'>1048</span>
<span class='line-number'>1049</span>
<span class='line-number'>1050</span>
<span class='line-number'>1051</span>
<span class='line-number'>1052</span>
<span class='line-number'>1053</span>
<span class='line-number'>1054</span>
<span class='line-number'>1055</span>
<span class='line-number'>1056</span>
<span class='line-number'>1057</span>
<span class='line-number'>1058</span>
<span class='line-number'>1059</span>
<span class='line-number'>1060</span>
<span class='line-number'>1061</span>
<span class='line-number'>1062</span>
<span class='line-number'>1063</span>
<span class='line-number'>1064</span>
<span class='line-number'>1065</span>
<span class='line-number'>1066</span>
<span class='line-number'>1067</span>
<span class='line-number'>1068</span>
<span class='line-number'>1069</span>
<span class='line-number'>1070</span>
<span class='line-number'>1071</span>
<span class='line-number'>1072</span>
<span class='line-number'>1073</span>
<span class='line-number'>1074</span>
<span class='line-number'>1075</span>
<span class='line-number'>1076</span>
<span class='line-number'>1077</span>
<span class='line-number'>1078</span>
<span class='line-number'>1079</span>
<span class='line-number'>1080</span>
<span class='line-number'>1081</span>
<span class='line-number'>1082</span>
<span class='line-number'>1083</span>
<span class='line-number'>1084</span>
<span class='line-number'>1085</span>
<span class='line-number'>1086</span>
<span class='line-number'>1087</span>
<span class='line-number'>1088</span>
<span class='line-number'>1089</span>
<span class='line-number'>1090</span>
<span class='line-number'>1091</span>
<span class='line-number'>1092</span>
<span class='line-number'>1093</span>
<span class='line-number'>1094</span>
<span class='line-number'>1095</span>
<span class='line-number'>1096</span>
<span class='line-number'>1097</span>
<span class='line-number'>1098</span>
<span class='line-number'>1099</span>
<span class='line-number'>1100</span>
<span class='line-number'>1101</span>
<span class='line-number'>1102</span>
<span class='line-number'>1103</span>
<span class='line-number'>1104</span>
<span class='line-number'>1105</span>
<span class='line-number'>1106</span>
<span class='line-number'>1107</span>
<span class='line-number'>1108</span>
<span class='line-number'>1109</span>
<span class='line-number'>1110</span>
<span class='line-number'>1111</span>
<span class='line-number'>1112</span>
<span class='line-number'>1113</span>
<span class='line-number'>1114</span>
<span class='line-number'>1115</span>
<span class='line-number'>1116</span>
<span class='line-number'>1117</span>
<span class='line-number'>1118</span>
<span class='line-number'>1119</span>
<span class='line-number'>1120</span>
<span class='line-number'>1121</span>
<span class='line-number'>1122</span>
<span class='line-number'>1123</span>
<span class='line-number'>1124</span>
<span class='line-number'>1125</span>
<span class='line-number'>1126</span>
<span class='line-number'>1127</span>
<span class='line-number'>1128</span>
<span class='line-number'>1129</span>
<span class='line-number'>1130</span>
<span class='line-number'>1131</span>
<span class='line-number'>1132</span>
<span class='line-number'>1133</span>
<span class='line-number'>1134</span>
<span class='line-number'>1135</span>
<span class='line-number'>1136</span>
<span class='line-number'>1137</span>
<span class='line-number'>1138</span>
<span class='line-number'>1139</span>
<span class='line-number'>1140</span>
<span class='line-number'>1141</span>
<span class='line-number'>1142</span>
<span class='line-number'>1143</span>
<span class='line-number'>1144</span>
<span class='line-number'>1145</span>
<span class='line-number'>1146</span>
<span class='line-number'>1147</span>
<span class='line-number'>1148</span>
<span class='line-number'>1149</span>
<span class='line-number'>1150</span>
<span class='line-number'>1151</span>
<span class='line-number'>1152</span>
<span class='line-number'>1153</span>
<span class='line-number'>1154</span>
<span class='line-number'>1155</span>
<span class='line-number'>1156</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * GDD 2010 DevQuiz Pacman for PHP 5.3</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @author @koriym</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * デバック用関数 p</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">function</span> <span class="nf">p</span><span class="p">(</span><span class="nv">$values</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$trace</span> <span class="o">=</span> <span class="nb">debug_backtrace</span><span class="p">();</span>
</span><span class='line'>    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$trace</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span><span class='line'>    <span class="nv">$line</span> <span class="o">=</span> <span class="nv">$trace</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;line&#39;</span><span class="p">];</span>
</span><span class='line'>    <span class="nv">$method</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$trace</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]))</span> <span class="o">?</span> <span class="s2">&quot; (</span><span class="si">{</span><span class="nv">$trace</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;class&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">.</span> <span class="s1">&#39;::&#39;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$trace</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;function&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$fileArray</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nx">FILE_USE_INCLUDE_PATH</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$p</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$fileArray</span><span class="p">[</span><span class="nv">$line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>    <span class="nb">unset</span><span class="p">(</span><span class="nv">$fileArray</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/p\((.+)[\s,\)]/&quot;</span><span class="p">,</span> <span class="nv">$p</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
</span><span class='line'>    <span class="nv">$varName</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//    $label = &quot;$varName in {$file} on line {$line}$method&quot;;</span>
</span><span class='line'>    <span class="nv">$label</span> <span class="o">=</span> <span class="s2">&quot;on line </span><span class="si">{</span><span class="nv">$line</span><span class="si">}$method</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nv">$values</span> <span class="o">=</span> <span class="nb">is_bool</span><span class="p">(</span><span class="nv">$values</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nv">$values</span> <span class="o">?</span> <span class="s2">&quot;true&quot;</span> <span class="o">:</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$values</span><span class="p">;</span>
</span><span class='line'>    <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="nv">$varName</span><span class="si">}</span><span class="s2">=[&quot;</span><span class="o">.</span> <span class="nb">print_r</span><span class="p">(</span><span class="nv">$values</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;] </span><span class="si">$label\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * キャラクターインターフェイス</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @param string $MyChar 文字</span>
</span><span class='line'><span class="sd"> * @param int    $y      y座標</span>
</span><span class='line'><span class="sd"> * @paramint     $x      x座標</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">interface</span> <span class="nx">Character_Interface</span><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$myChar</span><span class="p">,</span> <span class="nv">$y</span><span class="p">,</span> <span class="nv">$x</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * キャラクター</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Character</span> <span class="k">implements</span> <span class="nx">Character_Interface</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * キャラ文字</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_char</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * X座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_x</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Y座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_y</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * X移動</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_dx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Y移動</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_dy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 移動可能座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_wayToGo</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 移動可能場所数</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_wayToGoCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 時計回り配列</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$_clockwiseDirection</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * コンストラクタ</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $myChar</span>
</span><span class='line'><span class="sd">     * @param int    $x</span>
</span><span class='line'><span class="sd">     * @param int    $y</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$myChar</span><span class="p">,</span> <span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_myChar</span> <span class="o">=</span> <span class="nv">$myChar</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span> <span class="o">=</span> <span class="nv">$x</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span> <span class="o">=</span> <span class="nv">$y</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ポジション取得</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     *　@return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPosition</span><span class="p">(){</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * データ取得</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_myChar</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * キャラクタの移動可能状態をセット</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param array $maze              迷路</span>
</span><span class='line'><span class="sd">     * @param array $directionStrategy 移動方向戦略</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">_setPositionStatus</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$directionStrategy</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$wayToGo</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$directionStrategy</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">list</span><span class="p">(</span><span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$item</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$x</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span> <span class="o">+</span> <span class="nv">$dx</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$y</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span> <span class="o">+</span> <span class="nv">$dy</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$isExist</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span><span class="p">][</span><span class="nv">$x</span><span class="p">]);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$isExist</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $maze[$y][$x] === &#39;.&#39; || $maze[$y][$x] === &#39; &#39;) {</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;dy&#39;</span> <span class="o">=&gt;</span> <span class="nv">$dy</span><span class="p">,</span> <span class="s1">&#39;dx&#39;</span> <span class="o">=&gt;</span> <span class="nv">$dx</span><span class="p">);</span>
</span><span class='line'>                <span class="nv">$cnt</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGoCount</span> <span class="o">=</span> <span class="nv">$cnt</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * パックマン</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Pacman</span> <span class="k">extends</span> <span class="nx">Character</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 方向履歴</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_joyStick</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 移動足跡</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_footprintMap</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 移動足跡初期化</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param int $width 幅</span>
</span><span class='line'><span class="sd">     * @param int $hight 高さ</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setFootprintMap</span><span class="p">(</span><span class="nv">$width</span><span class="p">,</span> <span class="nv">$hight</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$hight</span> <span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_footprintMap</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">array_fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$width</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * パックマン移動</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param array        $maze     迷路</span>
</span><span class='line'><span class="sd">     * @param int          $time     タイム</span>
</span><span class='line'><span class="sd">     * @param Pacman_Dicon $strategy DIコンテナ</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">move</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$time</span><span class="p">,</span> <span class="nx">Pacman_Dicon</span> <span class="nv">$dicon</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$funcMoveStrategy</span> <span class="o">=</span> <span class="nv">$dicon</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;move&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_setPositionStatus</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$dicon</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">));</span>
</span><span class='line'>        <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">list</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">,</span> <span class="nv">$takeSnapShot</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$r</span> <span class="o">=</span> <span class="nv">$funcMoveStrategy</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">,</span> <span class="nv">$maze</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGoCount</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_footprintMap</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_joyStick</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$pacmanThought</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_joyStick</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>            <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$takeSnapShot</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getJoyStickChar</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$pacmanThought</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_joyStick</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span> <span class="o">+=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span> <span class="o">+=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_joyStick</span> <span class="o">.=</span> <span class="nx">self</span><span class="o">::</span><span class="na">getJoystickChar</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_footprintMap</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">,</span> <span class="nv">$takeSnapShot</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 方向からジョイスティック名を取得</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param int $dx</span>
</span><span class='line'><span class="sd">     * @param int $dy</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getJoyStickChar</span><span class="p">(</span><span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$joyStickCharacters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$direction</span> <span class="o">=</span> <span class="nb">array_search</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)));</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$joyStickCharacters</span><span class="p">[</span><span class="nv">$direction</span><span class="p">];</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 足跡文字列取得</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getJoystick</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_joyStick</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * パックマンDIコンテナ</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Pacman_Dicon</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * サービス取得</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $service サービス取得名</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return mixed</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$service</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">switch</span> <span class="p">(</span><span class="nv">$service</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="s1">&#39;direction&#39;</span><span class="o">:</span>
</span><span class='line'>                <span class="nv">$directionStrategy</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>                <span class="nb">shuffle</span><span class="p">(</span><span class="nv">$directionStrategy</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="nv">$directionStrategy</span><span class="p">;</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="k">case</span> <span class="s1">&#39;move&#39;</span><span class="o">:</span>
</span><span class='line'>                <span class="nv">$function</span> <span class="o">=</span>  <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">,</span> <span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">,</span> <span class="nv">$maze</span><span class="p">,</span> <span class="o">&amp;</span><span class="c1">#038;$wayCnt, $wayToGo, $footprintMap, $joystick)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="k">switch</span> <span class="p">(</span><span class="nv">$wayCnt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>                            <span class="c1">// 動けない</span>
</span><span class='line'>                            <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
</span><span class='line'>                        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>                            <span class="c1">// 行き止まりなので唯一いける方向へ</span>
</span><span class='line'>                            <span class="nv">$togo</span> <span class="o">=</span> <span class="nv">$wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>                            <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$togo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$togo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="k">false</span><span class="p">);</span>
</span><span class='line'>                        <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>                            <span class="c1">// バックじゃない方</span>
</span><span class='line'>                            <span class="nv">$isReverse0</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$dx</span> <span class="o">===</span> <span class="p">(</span><span class="nv">$wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $dy === ($wayToGo[0][&#39;dy&#39;] * -1));</span>
</span><span class='line'>                            <span class="nv">$isReverse1</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$dx</span> <span class="o">===</span> <span class="p">(</span><span class="nv">$wayToGo</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $dy === ($wayToGo[1][&#39;dy&#39;] * -1));</span>
</span><span class='line'>                            <span class="k">if</span> <span class="p">(</span><span class="nv">$isReverse0</span> <span class="o">||</span> <span class="nv">$isReverse1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                                <span class="nv">$i</span> <span class="o">=</span> <span class="o">!</span><span class="nv">$isReverse0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>                                <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$wayToGo</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$wayToGo</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="k">false</span><span class="p">);</span>
</span><span class='line'>                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                            <span class="p">}</span>
</span><span class='line'>                        <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>                        <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>                            <span class="c1">// 交差点で考える</span>
</span><span class='line'>                            <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="c1">// 同じ行動はとらない</span>
</span><span class='line'>                    <span class="nv">$wayToGoFiltered</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$wayToGo</span> <span class="k">as</span> <span class="nv">$toGo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$pacmanThought</span><span class="p">[</span><span class="nv">$joystick</span><span class="p">][</span><span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]][</span><span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]]))</span> <span class="p">{</span>
</span><span class='line'>                            <span class="nv">$wayToGoFiltered</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$toGo</span><span class="p">;</span>
</span><span class='line'>                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                            <span class="nv">$wayCnt</span><span class="o">--</span><span class="p">;</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$wayToGoFiltered</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="c1">// どこも行けない</span>
</span><span class='line'>                        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;no_way_to_go&#39;</span><span class="p">);</span>
</span><span class='line'>                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nv">$wayToGo</span> <span class="o">=</span> <span class="nv">$wayToGoFiltered</span><span class="p">;</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$wayToGoFiltered</span> <span class="k">as</span> <span class="nv">$toGo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="k">if</span> <span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span> <span class="o">+</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]][</span><span class="nv">$x</span> <span class="o">+</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]]</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                            <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$wayToGoFiltered</span> <span class="k">as</span> <span class="nv">$toGo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="k">if</span> <span class="p">(</span><span class="nv">$footprintMap</span><span class="p">[</span><span class="nv">$y</span> <span class="o">+</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">]][</span><span class="nv">$x</span> <span class="o">+</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                            <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$wayToGoFiltered</span> <span class="k">as</span> <span class="nv">$toGo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nv">$dx</span> <span class="o">=</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">];</span>
</span><span class='line'>                        <span class="nv">$dy</span> <span class="o">=</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">];</span>
</span><span class='line'>                        <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                            <span class="k">if</span> <span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span> <span class="o">+</span> <span class="nv">$dy</span><span class="p">][</span><span class="nv">$x</span> <span class="o">+</span> <span class="nv">$dx</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                                <span class="nv">$find</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>                                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                            <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span> <span class="o">+</span> <span class="nv">$dy</span><span class="p">][</span><span class="nv">$x</span> <span class="o">+</span> <span class="nv">$dx</span><span class="p">])</span> <span class="o">||</span> <span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span> <span class="o">+</span> <span class="nv">$dy</span><span class="p">][</span><span class="nv">$x</span> <span class="o">+</span> <span class="nv">$dx</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                                <span class="nv">$find</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>                                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                            <span class="p">}</span>
</span><span class='line'>                            <span class="nv">$dx</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>                            <span class="nv">$dy</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                        <span class="k">if</span> <span class="p">(</span><span class="nv">$find</span> <span class="o">===</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                            <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$toGo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="nv">$dx</span> <span class="o">=</span> <span class="nv">$wayToGoFiltered</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">];</span>
</span><span class='line'>                    <span class="nv">$dy</span> <span class="o">=</span> <span class="nv">$wayToGoFiltered</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">];</span>
</span><span class='line'>                    <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$function</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * パックマンDIコンテナ 問題１用</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Pacman_Dicon_Q1</span> <span class="k">extends</span> <span class="nx">Pacman_Dicon</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * サービス取得</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $service サービス取得名</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return mixed</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$service</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">switch</span> <span class="p">(</span><span class="nv">$service</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="s1">&#39;direction&#39;</span><span class="o">:</span>
</span><span class='line'>                <span class="c1">//$directionStrategy = array(array(-1, 0), array(0, -1), array(1, 0), array(0, 1), array(0, 0));</span>
</span><span class='line'>                <span class="nv">$directionStrategy</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>                <span class="nb">shuffle</span><span class="p">(</span><span class="nv">$directionStrategy</span><span class="p">);</span>
</span><span class='line'>                <span class="k">return</span> <span class="nv">$directionStrategy</span><span class="p">;</span>
</span><span class='line'>            <span class="k">case</span> <span class="s1">&#39;move&#39;</span><span class="o">:</span>
</span><span class='line'>                <span class="nv">$function</span> <span class="o">=</span>  <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">,</span> <span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">,</span> <span class="nv">$maze</span><span class="p">,</span> <span class="o">&amp;</span><span class="c1">#038;$wayCnt, $wayToGo, $footprintMap, $joystick)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="nv">$wayToGo</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nv">$dx</span> <span class="o">=</span> <span class="nv">$wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">];</span>
</span><span class='line'>                        <span class="nv">$dy</span> <span class="o">=</span> <span class="nv">$wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">];</span>
</span><span class='line'>                        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;no_way_to_go&#39;</span><span class="p">);</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$function</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * モンスター</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Monster</span> <span class="k">extends</span> <span class="nx">Character</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 最初？</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var bool</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_init</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスターL</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_j</span> <span class="o">=</span> <span class="s1">&#39;L&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 移動</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param array $maze</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanY</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">move</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_init</span> <span class="o">===</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//時刻 t = 0 においては、初期位置の 下、左、上、右 の順で最初に進入可能なマスの方向に移動します。</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_init</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_setPositionStatus</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_clockwiseDirection</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">];</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//下、左、上、右 の順</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_setPositionStatus</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_clockwiseDirection</span><span class="p">);</span>
</span><span class='line'>            <span class="k">switch</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGoCount</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>                    <span class="c1">// 行き止まりなので唯一いける方向へ</span>
</span><span class='line'>                    <span class="nv">$togo</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span> <span class="o">=</span> <span class="nv">$togo</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">];</span>
</span><span class='line'>                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span> <span class="o">=</span> <span class="nv">$togo</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">];</span>
</span><span class='line'>                <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>                    <span class="c1">// バックじゃない方</span>
</span><span class='line'>                    <span class="nv">$isReverse</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span> <span class="o">===</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $this-&gt;_dy === ($this-&gt;_wayToGo[0][&#39;dy&#39;] * -1));</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="nv">$isReverse</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">];</span>
</span><span class='line'>                        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">];</span>
</span><span class='line'>                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">];</span>
</span><span class='line'>                        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">];</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>                <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>                    <span class="c1">// モンスターに応じて</span>
</span><span class='line'>                    <span class="nv">$method</span> <span class="o">=</span> <span class="s1">&#39;_move&#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_myChar</span><span class="p">;</span>
</span><span class='line'>                    <span class="k">list</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">);</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $this-&gt;_dy == 0){</span>
</span><span class='line'>                        <span class="nx">p</span><span class="p">(</span><span class="s2">&quot;error </span><span class="si">$this-&gt;_myChar</span><span class="s2">&quot;</span><span class="p">);</span><span class="k">exit</span><span class="p">();</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>                <span class="k">default</span><span class="o">:</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span> <span class="o">+=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span> <span class="o">+=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">;</span>
</span><span class='line'>        <span class="c1">// もし以前パックマンがいたところに移動したら”王手”。パックマンは前にモンスターがいたところには移動できない。仮に壁にする。</span>
</span><span class='line'>        <span class="nv">$makeMeWall</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span> <span class="o">===</span> <span class="nv">$pacmanX</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $this-&gt;_y === $pacmanY);</span>
</span><span class='line'>        <span class="nv">$wall</span> <span class="o">=</span> <span class="nv">$makeMeWall</span> <span class="o">?</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;x&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">)</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_myChar</span><span class="p">,</span> <span class="nv">$wall</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスターV</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * 敵から見た自機の相対位置を (dx, dy) と表すものとします。次のルールを上から順に適用し、最初に選ばれた方向に移動します。</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * 1. dy ≠ 0 でかつ dy の符号方向にあるマスが進入可能であれば、その方向に移動します。</span>
</span><span class='line'><span class="sd">     * 2. dx ≠ 0 でかつ dx の符号方向にあるマスが進入可能であれば、その方向に移動します。</span>
</span><span class='line'><span class="sd">     * 3. 現在位置の 下、左、上、右 の順で最初に進入可能なマスの方向に移動する。</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param array $maze    迷路</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンX座標</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンY座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_moveV</span><span class="p">(</span><span class="k">array</span> <span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$dx</span> <span class="o">=</span> <span class="nv">$pacmanX</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$dy</span> <span class="o">=</span> <span class="nv">$pacmanY</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">;</span>
</span><span class='line'>        <span class="c1">// 1</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$dy</span> <span class="o">!==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$ddy</span> <span class="o">=</span> <span class="nv">$dy</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="nv">$dy</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span> <span class="o">+</span> <span class="nv">$ddy</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">])</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $maze[$this-&gt;_y + $ddy][$this-&gt;_x] !== &#39;#&#39;) {</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$ddy</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// 2</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$dx</span> <span class="o">!==</span> <span class="mi">0</span> <span class="p">){</span>
</span><span class='line'>            <span class="nv">$ddx</span> <span class="o">=</span> <span class="nv">$dx</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="nv">$dx</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span> <span class="o">+</span> <span class="nv">$ddx</span><span class="p">])</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $maze[$this-&gt;_y][$this-&gt;_x + $ddx] !== &#39;#&#39;) {</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$ddx</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// 3</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスターH</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * 敵 V とほぼ同じです。唯一異なるのは 、進行方向を決めるルールのうち</span>
</span><span class='line'><span class="sd">     * 最初の二つのルールの適用順序が入れ替わるところです。</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param array $maze    迷路</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンX座標</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンY座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_moveH</span><span class="p">(</span><span class="k">array</span> <span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$dx</span> <span class="o">=</span> <span class="nv">$pacmanX</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$dy</span> <span class="o">=</span> <span class="nv">$pacmanY</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">;</span>
</span><span class='line'>        <span class="c1">// 2</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$dx</span> <span class="o">!==</span> <span class="mi">0</span> <span class="p">){</span>
</span><span class='line'>            <span class="nv">$ddx</span> <span class="o">=</span> <span class="nv">$dx</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="nv">$dx</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span> <span class="o">+</span> <span class="nv">$ddx</span><span class="p">])</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $maze[$this-&gt;_y][$this-&gt;_x + $ddx] !== &#39;#&#39;) {</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$ddx</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// 1</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$dy</span> <span class="o">!==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$ddy</span> <span class="o">=</span> <span class="nv">$dy</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="nv">$dy</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_y</span> <span class="o">+</span> <span class="nv">$ddy</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_x</span><span class="p">])</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $maze[$this-&gt;_y + $ddy][$this-&gt;_x] !== &#39;#&#39;) {</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$ddy</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// 3</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスターL</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * 現在位置への進入方向から見て相対的に 左、前、右 の順</span>
</span><span class='line'><span class="sd">     * @param array $maze    迷路</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンX座標</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンY座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_moveL</span><span class="p">(</span><span class="k">array</span> <span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$directionStrategy</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getRelativeDirection</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_setPositionStatus</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$directionStrategy</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスターR</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * 現在位置への進入方向から見て相対的に 右、前、左  の順</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param array $maze    迷路</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンX座標</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンY座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_moveR</span><span class="p">(</span><span class="k">array</span> <span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$directionStrategy</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getRelativeDirection</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_setPositionStatus</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$directionStrategy</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dx&#39;</span><span class="p">],</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_wayToGo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dy&#39;</span><span class="p">]);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスターJ</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * 最初は敵Lの行動、次回は敵Rの行動、さらに次回はまた敵Lの行動、と繰り返します。</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param array $maze    迷路</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンX座標</span>
</span><span class='line'><span class="sd">     * @param int   $pacmanX パックマンY座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_moveJ</span><span class="p">(</span><span class="k">array</span> <span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$method</span> <span class="o">=</span> <span class="s2">&quot;_move</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">(</span><span class="nv">$maze</span><span class="p">,</span> <span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_j</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_j</span> <span class="o">===</span> <span class="s1">&#39;L&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;R&#39;</span> <span class="o">:</span> <span class="s1">&#39;L&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 進行方向に対しての相対方向（左右など）戦略の配列を作成</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param interger $relativeDirection 1=右, -1=左</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_getRelativeDirection</span><span class="p">(</span><span class="nv">$relativeDirections</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$currentDirection</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dx</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_dy</span><span class="p">);</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$relativeDirections</span> <span class="k">as</span> <span class="nv">$relativeDirection</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$pos</span> <span class="o">=</span> <span class="nb">array_search</span><span class="p">(</span><span class="nv">$currentDirection</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_clockwiseDirection</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$directionIndex</span> <span class="o">=</span> <span class="nv">$pos</span> <span class="o">+</span> <span class="nv">$relativeDirection</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$directionIndex</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$directionIndex</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$directionIndex</span> <span class="o">===</span> <span class="mi">4</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$directionIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nb">array_push</span><span class="p">(</span><span class="nv">$result</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_clockwiseDirection</span><span class="p">[</span><span class="nv">$directionIndex</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * ゲーム</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Pacman_Game</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * スコア</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * クリアスコア</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_clearScore</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 制限時間</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_timeOut</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 時間</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * パックマン</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var Pacman</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_pacman</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスター</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_monsters</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 迷路</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_maze</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * キャラ付迷路</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_mazeWithChar</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * キャラなし迷路</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_mazeWithoutChar</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * パックマンX座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_pacmanX</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * パックマンY座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_pacmanY</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * デバック?</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var bool</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_debug</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * デバックアニメーション時間</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_debugTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * デバックアニメーション?</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var bool</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_debugAnimation</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * パックマンDIコンテナ</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var Pacman_Dicon</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_pacmanDicon</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * __clone</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$cloneMonsters</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_monsters</span> <span class="k">as</span> <span class="nv">$monster</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$cloneMonsters</span><span class="p">[]</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$monster</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_monsters</span> <span class="o">=</span> <span class="nv">$cloneMonsters</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 迷路から必要なオブジェクトやプロパティをセット</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * +Pacmanオブジェクト</span>
</span><span class='line'><span class="sd">     * +Monsterオブジェクト</span>
</span><span class='line'><span class="sd">     * +ドットの数</span>
</span><span class='line'><span class="sd">     * +キャラクターがいない迷路</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_injectFromMaze</span><span class="p">(</span><span class="nv">$maze</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$point</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_monsters</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="nv">$y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span><span class="p">]);</span> <span class="nv">$y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">for</span><span class="p">(</span><span class="nv">$x</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="nv">$x</span> <span class="o">&lt;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span><span class="p">]);</span> <span class="nv">$x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$char</span> <span class="o">=</span> <span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span><span class="p">][</span><span class="nv">$x</span><span class="p">];</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="nv">$char</span> <span class="o">===</span> <span class="s1">&#39;@&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pacman</span><span class="p">(</span><span class="nv">$char</span><span class="p">,</span> <span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span>
</span><span class='line'>                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span><span class="o">-&gt;</span><span class="na">setFootprintMap</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$maze</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$maze</span><span class="p">));</span>
</span><span class='line'>                    <span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span><span class="p">][</span><span class="nv">$x</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$char</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nv">$point</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/[A-Z]/&#39;</span><span class="p">,</span> <span class="nv">$char</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_monsters</span><span class="p">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Monster</span><span class="p">(</span><span class="nv">$char</span><span class="p">,</span> <span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">);</span>
</span><span class='line'>                    <span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span><span class="p">][</span><span class="nv">$x</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_clearScore</span> <span class="o">=</span> <span class="nv">$point</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_maze</span> <span class="o">=</span> <span class="nv">$maze</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 問題１</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">_injectQuestionOne</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$maze</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;###########&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.V..#..H.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.##...##.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#L#..#..R.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.#.###.#.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#....@....#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;###########&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_injectFromMaze</span><span class="p">(</span><span class="nv">$maze</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanDicon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pacman_Dicon_Q1</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_timeOut</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 問題2</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">_injectQuestionTwo</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$maze</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;####################&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;###.....L..........#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;###.##.##.##L##.##.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;###.##.##.##.##.##.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.L................#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.##.##.##.##.##.###&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.##.##L##.##.##.###&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.................L#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.#.#.#J####J#.#.#.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#L.................#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;###.##.##.##.##.##.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;###.##.##R##.##.##.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#................R.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.##.##.##.##R##.###&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.##.##.##.##.##.###&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#@....R..........###&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;####################&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_injectFromMaze</span><span class="p">(</span><span class="nv">$maze</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanDicon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pacman_Dicon</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_timeOut</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 問題3</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">_injectQuestionThree</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$maze</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;##########################################################&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#........................................................#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.###.#########.###############.########.###.#####.#####.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.###.#########.###############.########.###.#####.#####.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.....#########....J.............J.......###.............#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#####.###.......#######.#######.########.###.#######.#####&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#####.###.#####J#######.#######.########.###.##   ##.#####&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#####.###L#####.##   ##L##   ##.##    ##.###.##   ##.#####&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#####.###..H###.##   ##.##   ##.########.###.#######J#####&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#####.#########.##   ##L##   ##.########.###.###V....#####&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#####.#########.#######.#######..........###.#######.#####&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#####.#########.#######.#######.########.###.#######.#####&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.....................L.........########..........R......#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#L####.##########.##.##########....##....#########.#####.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.####.##########.##.##########.##.##.##.#########.#####.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;#.................##............##..@.##...............R.#&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$maze</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_split</span><span class="p">(</span><span class="s1">&#39;##########################################################&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_injectFromMaze</span><span class="p">(</span><span class="nv">$maze</span><span class="p">);</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanDicon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pacman_Dicon</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_timeOut</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 初期化</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">init</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// init</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithoutChar</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_maze</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanX</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * パックマン取得</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return Pacman</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getPacman</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 1ゲームプレイ</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">runGame</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// init</span>
</span><span class='line'>        <span class="nv">$lastGame</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$isHit</span> <span class="o">=</span> <span class="nv">$isTimeOut</span> <span class="o">=</span> <span class="nv">$isClear</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$gameCount</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>        <span class="c1">// main</span>
</span><span class='line'>        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$isHit</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; !$isClear) {</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_time</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$isTimeOut</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_time</span> <span class="o">&gt;=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_timeOut</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$isTimeOut</span> <span class="o">===</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="c1">// モンスター</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_runMonsters</span><span class="p">();</span>
</span><span class='line'>            <span class="c1">// pacman</span>
</span><span class='line'>            <span class="k">list</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanX</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanY</span><span class="p">,</span> <span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">,</span> <span class="nv">$takeSnapShot</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_time</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanDicon</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithoutChar</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanY</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanX</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithoutChar</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanY</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanX</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="c1">// 描画</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanY</span><span class="o">-</span> <span class="nv">$dy</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanX</span> <span class="o">-</span> <span class="nv">$dx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanY</span><span class="p">][</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanX</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;@&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$takeSnapShot</span> <span class="o">===</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">//  パックマンが曲がるのでスナップショット</span>
</span><span class='line'>                <span class="nv">$joy</span> <span class="o">=</span> <span class="nv">$lastGame</span><span class="o">-&gt;</span><span class="na">getPacman</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getJoystick</span><span class="p">();</span>
</span><span class='line'>                <span class="nb">array_push</span><span class="p">(</span><span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$games</span><span class="p">,</span> <span class="nv">$lastGame</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="c1">// 後処理</span>
</span><span class='line'>            <span class="nv">$isClear</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span> <span class="o">==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_clearScore</span><span class="p">);</span>
</span><span class='line'>            <span class="c1">//            $restDot = $this-&gt;_clearScore - $this-&gt;_score;</span>
</span><span class='line'>            <span class="c1">//            $isTimeOut = ($restDot &gt; $this-&gt;_timeOut - $this-&gt;_time || $this-&gt;_time &gt;= Pacman_Quiz::$minClearTime + $restDot);</span>
</span><span class='line'>            <span class="nv">$isHit</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_hitCheck</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanX</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanY</span><span class="p">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_debug</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_showCompositScreen</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithoutChar</span><span class="p">);</span>
</span><span class='line'>                <span class="nb">usleep</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_debugTime</span><span class="p">);</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_debugAnimation</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[;H</span><span class="se">\033</span><span class="s2">[2J&quot;</span><span class="p">;</span> <span class="c1">// clear screen</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$joy</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span><span class="o">-&gt;</span><span class="na">getJoystick</span><span class="p">();</span>
</span><span class='line'>            <span class="nv">$lastGame</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$this</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$isTimeOut</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//            $this-&gt;_checkRepeatGame();</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_gameOver</span><span class="p">(</span><span class="s1">&#39;TimeOut&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$isHit</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;hit&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$isClear</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_time</span> <span class="o">&gt;=</span> <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$minClearTime</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$minClearTime</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_time</span><span class="p">;</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_gameOver</span><span class="p">(</span><span class="s1">&#39;Clear&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ゲームを繰り返していないかdebugチェック</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_checkRepeatGame</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">static</span> <span class="nv">$joystat</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$joy</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span><span class="o">-&gt;</span><span class="na">getJoystick</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$key</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$joy</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$joystat</span><span class="p">[</span><span class="nv">$key</span><span class="p">]))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$joystat</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>            <span class="k">echo</span> <span class="s2">&quot;repeated. </span><span class="si">$joy\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$joystat</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * モンスター移動</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_runMonsters</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithoutChar</span><span class="p">;</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_monsters</span> <span class="k">as</span> <span class="nv">$monster</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">list</span><span class="p">(</span><span class="nv">$monsterX</span><span class="p">,</span> <span class="nv">$monsterY</span><span class="p">,</span> <span class="nv">$myChar</span><span class="p">,</span> <span class="nv">$wall</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$monster</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithoutChar</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanX</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacmanY</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span><span class="p">[</span><span class="nv">$monsterY</span><span class="p">][</span><span class="nv">$monsterX</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$myChar</span><span class="p">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$wall</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_mazeWithChar</span><span class="p">[</span><span class="nv">$wall</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]][</span><span class="nv">$wall</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ハイスコアセット</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setHighScore</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span> <span class="o">&gt;</span> <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$highscore</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$highscore</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Game Over画面出力</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param string $reason　      ゲームオーバーの理由</span>
</span><span class='line'><span class="sd">     * @param string $mazeWithChar　キャラクター付迷路</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">_gameOver</span><span class="p">(</span><span class="nv">$reason</span><span class="p">,</span> <span class="nv">$mazeWithChar</span><span class="p">,</span> <span class="nv">$forceShow</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$forceShow</span> <span class="o">||</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span> <span class="o">&gt;</span> <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$highscore</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$highscore</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span><span class="p">;</span>
</span><span class='line'>            <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_showCompositScreen</span><span class="p">(</span><span class="nv">$mazeWithChar</span><span class="p">);</span>
</span><span class='line'>            <span class="nv">$msg</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$reason</span> <span class="o">===</span> <span class="s1">&#39;clear&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;Game Clear&quot;</span> <span class="o">:</span> <span class="s2">&quot;GAME OVER(</span><span class="si">$reason</span><span class="s2">)&quot;</span> <span class="p">;</span>
</span><span class='line'>            <span class="k">echo</span> <span class="s2">&quot;High Score:&quot;</span> <span class="o">.</span> <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$highscore</span> <span class="o">.</span> <span class="s1">&#39; total:&#39;</span><span class="o">.</span> <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$gameCount</span> <span class="o">.</span> <span class="s2">&quot; </span><span class="si">$msg\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ヒットチェック</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param $pacmanX パックマンX座標</span>
</span><span class='line'><span class="sd">     * @param $pacmanY パックマンY座標</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return bool</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">_hitCheck</span><span class="p">(</span><span class="nv">$pacmanX</span><span class="p">,</span> <span class="nv">$pacmanY</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$isHit</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_monsters</span> <span class="k">as</span> <span class="nv">$monster</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">list</span><span class="p">(</span><span class="nv">$monsterX</span><span class="p">,</span> <span class="nv">$monsterY</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$monster</span><span class="o">-&gt;</span><span class="na">getPosition</span><span class="p">();</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$pacmanX</span> <span class="o">===</span> <span class="nv">$monsterX</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $pacmanY == $monsterY) {</span>
</span><span class='line'>                <span class="nv">$isHit</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$isHit</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * デバックモード</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param int $time アニメーションタイム</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setDebug</span><span class="p">(</span><span class="nv">$time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_debugTime</span> <span class="o">=</span>  <span class="nv">$time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_debugAnimation</span> <span class="o">=</span> <span class="p">(</span><span class="nb">is_integer</span><span class="p">(</span><span class="nv">$time</span><span class="p">)</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; $time &gt; 0) ? true : false;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_debug</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * 迷路配列作成</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_split</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$result</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>            <span class="nv">$result</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="nv">$i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$result</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ゲーム画面描画</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @reutnr void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_showCompositScreen</span><span class="p">(</span><span class="k">array</span> <span class="nv">$maze</span><span class="p">,</span> <span class="nv">$debug</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$characters</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_monsters</span><span class="p">;</span>
</span><span class='line'>        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$characters</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span><span class="p">);</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$characters</span> <span class="k">as</span> <span class="nv">$character</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">list</span><span class="p">(</span><span class="nv">$char</span><span class="p">,</span> <span class="nv">$x</span><span class="p">,</span> <span class="nv">$y</span><span class="p">,</span> <span class="nv">$dx</span><span class="p">,</span> <span class="nv">$dy</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$character</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span><span class='line'>            <span class="nv">$maze</span><span class="p">[</span><span class="nv">$y</span><span class="p">][</span><span class="nv">$x</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$char</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$maze</span> <span class="k">as</span> <span class="nv">$y</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">echo</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$y</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$point</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span> <span class="o">===</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_clearScore</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_timeOut</span> <span class="o">-</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_time</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span> <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s2">&quot;Score:</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_score</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_clearScore</span><span class="si">}</span><span class="s2"> Point:</span><span class="si">{</span><span class="nv">$point</span><span class="si">}</span><span class="s2"> Game:</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_time</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_timeOut</span><span class="si">}</span><span class="s2"> Stacked Game:&quot;</span> <span class="o">.</span> <span class="nb">count</span><span class="p">(</span><span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$games</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s2">&quot;High Score: &quot;</span><span class="o">.</span> <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$highscore</span> <span class="o">.</span> <span class="s1">&#39; total: &#39;</span><span class="o">.</span> <span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$gameCount</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">echo</span> <span class="s2">&quot;Play:&quot;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_pacman</span><span class="o">-&gt;</span><span class="na">getJoystick</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * パックマンクイズ</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @author akihito</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Pacman_Quiz</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * パックマンの行動</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="nv">$pacmanThought</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ゲーム</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="nv">$games</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ハイスコア</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="nv">$highscore</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * クリア最小時間</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="nv">$minClearTime</span> <span class="o">=</span> <span class="mi">999</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ゲーム回数</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var int</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="nv">$gameCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * TimeOutの時にゲームをpopするか</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @var bool</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$_popOnTimeOut</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * TimeOutの時にゲームをpopするかを設定</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param bool $setPopOnTimeout</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">setPopOnTimeout</span><span class="p">(</span><span class="nv">$setPopOnTimeout</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_setPopOnTimeout</span> <span class="o">=</span> <span class="nv">$setPopOnTimeout</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * クイズ実行</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">(</span><span class="nv">$injector</span> <span class="o">=</span> <span class="s1">&#39;_injectQuestionThree&#39;</span><span class="p">,</span> <span class="nv">$debug</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$game</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pacman_Game</span><span class="p">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$debug</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$game</span><span class="o">-&gt;</span><span class="na">setDebug</span><span class="p">(</span><span class="nv">$debug</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$game</span><span class="o">-&gt;</span><span class="nv">$injector</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$game</span><span class="o">-&gt;</span><span class="na">init</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$firstGame</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$game</span><span class="p">;</span>
</span><span class='line'>        <span class="nb">array_push</span><span class="p">(</span><span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$games</span><span class="p">,</span> <span class="nv">$firstGame</span><span class="p">);</span>
</span><span class='line'>        <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$game</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">echo</span> <span class="s2">&quot;All Game is Over.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>                <span class="k">break</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$game</span><span class="o">-&gt;</span><span class="na">runGame</span><span class="p">();</span>
</span><span class='line'>                <span class="nv">$game</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$games</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$game</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$games</span><span class="p">);</span>
</span><span class='line'>                <span class="nv">$result</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_showCounter</span><span class="p">();</span>
</span><span class='line'>            <span class="c1">// Time Out</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">===</span> <span class="k">true</span> <span class="o">&amp;</span><span class="c1">#038;&amp;#038; !$this-&gt;_popOnTimeOut) {</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$pacmanThought</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>                <span class="nx">self</span><span class="o">::</span><span class="nv">$games</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$games</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>                <span class="nv">$game</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nx">Pacman_Quiz</span><span class="o">::</span><span class="nv">$games</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * クイズ実行　（問題１用）</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">run1</span><span class="p">(</span><span class="nv">$injector</span> <span class="o">=</span> <span class="s1">&#39;_injectQuestionOne&#39;</span><span class="p">,</span> <span class="nv">$debug</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$game</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pacman_Game</span><span class="p">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$debug</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="nv">$game</span><span class="o">-&gt;</span><span class="na">setDebug</span><span class="p">(</span><span class="nv">$debug</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nv">$game</span><span class="o">-&gt;</span><span class="nv">$injector</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$game</span><span class="o">-&gt;</span><span class="na">init</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$firstGame</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$game</span><span class="p">;</span>
</span><span class='line'>        <span class="nb">array_push</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$games</span><span class="p">,</span> <span class="nv">$firstGame</span><span class="p">);</span>
</span><span class='line'>        <span class="k">do</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$game</span><span class="o">-&gt;</span><span class="na">runGame</span><span class="p">();</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="nv">$game</span><span class="o">-&gt;</span><span class="na">setHighScore</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$games</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$pacmanThought</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
</span><span class='line'>            <span class="nv">$game</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$firstGame</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * カウンタ表示</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_showCounter</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">static</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nv">$i</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">echo</span> <span class="s2">&quot;.</span><span class="si">$i</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// クイズ実行</span>
</span><span class='line'><span class="nv">$quiz</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Pacman_Quiz</span><span class="p">();</span>
</span><span class='line'><span class="c1">//$quiz-&gt;setPopOnTimeout(true); // true:TimeOutしてもスタックからゲームを取り出すモード</span>
</span><span class='line'><span class="c1">//$quiz-&gt;run1(&#39;_injectQuestionOne&#39;);</span>
</span><span class='line'><span class="c1">//$quiz-&gt;run(&#39;_injectQuestionTwo&#39;);</span>
</span><span class='line'><span class="c1">// 問題３</span>
</span><span class='line'><span class="c1">//$quiz-&gt;run(&#39;_injectQuestionThree&#39;, true); //逐次画面描画</span>
</span><span class='line'><span class="nv">$quiz</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="s1">&#39;_injectQuestionThree&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>    <span class="c1">//アニメーション</span>
</span><span class='line'><span class="c1">//$quiz-&gt;run(&#39;_injectQuestionThree&#39;);       //ハイスコアチャレンジ</span>
</span></code></pre></td></tr></table></div></figure>




<ol class="footnotes">
  <li id="footnote_0_112" class="footnote">
    この動画はAIによる移動です。再現プレイではありません。 [<a href="#identifier_0_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_1_112" class="footnote">
    結局その見通しは大甘でした [<a href="#identifier_1_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_2_112" class="footnote">
    AKABE? [<a href="#identifier_2_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_3_112" class="footnote">
    モンスタークラスにそれぞれの性格のモンスターがメソッドとして実装されていて迷路とPacmanの座標を受け取ったメソッドが進行方向を配列で返します。 [<a href="#identifier_3_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_4_112" class="footnote">
    95%以上得点が圧縮調整されてました。参加者の得点が高かったのでしょう [<a href="#identifier_4_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_5_112" class="footnote">
    それぐらい知っとけという感じですが [<a href="#identifier_5_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_6_112" class="footnote">
    正に深さ優先探索！ [<a href="#identifier_6_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_7_112" class="footnote">
    ゲームオブジェクトはプロパティとしてモンスターやパックマンのオブジェクトなどゲーム要素全てもっています。 [<a href="#identifier_7_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_8_112" class="footnote">
    メモリと時間が許せば [<a href="#identifier_8_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_9_112" class="footnote">
    その方がスコアが良く、ランダムで繰り返しても同じゲームが再現することがほとんどありませんででした [<a href="#identifier_9_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_10_112" class="footnote">
    ゲームオーバー時に積まれたゲームスタックを再評価し、10,000回に一回しか出ないような良いスコアの途中のゲーム状態から再開してみる..など色々やってみましたがあまりスコアアップに繋がりませんでした。オライリー本にもありますが"大器晩成型"のスコアがとであがってくるタイプのを消してしまうからではないかと思いました。 [<a href="#identifier_10_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_11_112" class="footnote">
    これも膨大なメモリを要します。他にもいろいろな探索がオライリー本に紹介されてますがどれが一番向いてたのでしょうか [<a href="#identifier_11_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_12_112" class="footnote">
    残りドットが少なくなったら取りにいくロジックを追加したらかなり性能があがるかもしれません [<a href="#identifier_12_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_13_112" class="footnote">
    アセンブラは16bitのスーパーファミコン(65816)、メガドライブ (680000+Z80)までやりました [<a href="#identifier_13_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_14_112" class="footnote">
    懐かしい響き! [<a href="#identifier_14_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_15_112" class="footnote">
    自機が”＠”でした！当時いろんなゲームの自機が@。PC-6001用ASCIIのAXシリーズとか... [<a href="#identifier_15_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_16_112" class="footnote">
    動作確認にも大変世話になりました [<a href="#identifier_16_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
  <li id="footnote_17_112" class="footnote">
    AI検索のみの移動です。人の手による修正はありません [<a href="#identifier_17_112" class="footnote-link footnote-back-link">&#8617;</a>]
  </li>
</ol>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">admin</span></span>

      




<time class='entry-date' datetime='2010-09-17T00:00:00+09:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2010</span></span> <span class='time'>12:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/puroguramu/'>プログラム</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://koriym.github.io/2010/09/gdd-2010-pacman%e5%95%8f%e9%a1%8c/" data-via="koriym" data-counturl="http://koriym.github.io/2010/09/gdd-2010-pacman%e5%95%8f%e9%a1%8c/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
  
  <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button"
     data-hatena-bookmark-layout="standard"
     data-hatena-bookmark-url="http://koriym.github.io/2010/09/gdd-2010-pacman%e5%95%8f%e9%a1%8c/">
    <img src="http://b.st-hatena.com/images/entry-button/button-only.gif"
         alt="このエントリーをはてなブックマークに追加" width="20" height="20"
         style="border: none">
  </a>
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2010/05/resource_cache/" title="Previous Post: リソースキャッシュ">&laquo; リソースキャッシュ</a>
      
      
        <a class="basic-alignment right" href="/2011/01/php%e3%82%82%e3%82%84%e3%82%89%e3%81%aa%e3%81%8d%e3%82%83hudson/" title="Next Post: PHPもやらなきゃHudson">PHPもやらなきゃHudson &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/03/18/phpnw/">PHPNW17</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/11/10/re-code-reading/">Re: BEAR.Sundayをコードリーディングしたのでメモ程度にアウトプットする</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/07/28/an-interface-as-an-api/">An Interface as an API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/04/php7-dot-0-0/">PHP7.0.0</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/01/phpconfuk2015/">基調講演「全てを結ぶ力」(2015)</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/koriym">@koriym</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'koriym',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/102811656239290261200?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Akihito Koriyama -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'koriym';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script>
    (function(w,d){
        var c,e=d.createDocumentFragment(),f=d.getElementsByTagName("script")[0],
                a=function(a,b){if(!d.getElementById(b)){c=d.createElement("script");
                    c.src=a;c.id=b||null;c.async=true;e.appendChild(c);}};
                a("//b.st-hatena.com/js/bookmark_button_wo_al.js");
                f.parentNode.insertBefore(e,f);
            })(this,document);
</script>


</body>
</html>
